<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản lý Báo giá Thiết bị</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <!-- Thư viện xlsx -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <style>
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <!-- <button onclick="openReviewModal()">dfdf</button> -->
  <body class="bg-black text-white p-2">
    <!-- Header -->
    <div class="flex justify-between">
      <h3
        class="text-3xl font-bold flex items-center gap-2 border-b-4 border-blue-300 text-white flex-1"
      >
        <i class="fas fa-file-invoice-dollar text-blue-400 p-3"></i>
        List Request Repair
      </h3>
    </div>

    <!-- Filter -->
    <details class="bg-gray-800 rounded p-3 my-2">
      <summary class="cursor-pointer font-semibold text-blue-400">
        Apply Filter
      </summary>
      <div id="Filter">
        <div class="flex gap-2 justify-between mb-2 relative">
          <div class="absolute right-0 top-[-1rem] flex gap-1">
            <button
              id="applyFilter"
              class="z-10 cursor-pointer px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:opacity-90 rounded text-sm text-white flex items-center gap-2"
            >
              <i class="fas fa-filter text-green-300"></i> Filter
            </button>

            <button
              id="clearFilter"
              class="z-10 cursor-pointer px-4 py-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:opacity-90 rounded text-sm text-white flex items-center gap-2"
            >
              <i class="fa-solid fa-filter-circle-xmark text-red-500"></i> Clear
              Filter
            </button>
          </div>
          <!-- idReFilter -->
          <div class="flex-1 w-full">
            <label for="idReFilter" class="block text-blue-300">ID Req</label>
            <input
              type="text"
              placeholder="ID Req"
              id="idReFilter"
              class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-sm text-white flex-1 w-full"
            />
          </div>

          <!-- deviceFilter -->
          <div class="flex-1">
            <label for="deviceFilter" class="block text-blue-300"
              >Device:</label
            >
            <input
              type="text"
              placeholder="Device"
              id="deviceFilter"
              class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-sm text-white flex-1 w-full"
            />
          </div>

          <!-- requestedByFilter -->
          <div class="flex-1">
            <label for="requestedByFilter" class="block text-blue-300"
              >Requested By:</label
            >
            <input
              type="text"
              placeholder="Requested By"
              id="requestedByFilter"
              class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-sm text-white flex-1 w-full"
            />
          </div>

          <!-- Department filter -->
          <div class="flex-1 relative">
            <label for="departmentFilter" class="block text-blue-300"
              >Department:</label
            >
            <input
              onfocus="toggleFilterChecklist('departmentCheckList')"
              onblur="closeChecklistOnBlur('departmentCheckList')"
              type="text"
              readonly
              placeholder="Department"
              id="departmentFilter"
              class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-sm text-white flex-1 w-full"
            />
            <!-- Department Checklist -->
            <div
              id="departmentCheckList"
              tabindex="0"
              class="hidden mt-2 bg-gray-800 p-3 rounded shadow border border-gray-700 absolute top-[90%] left-0 w-full z-10"
            >
              <div
                class="flex flex-col gap-1"
                id="departmentChecklistContent"
              ></div>
            </div>
          </div>
        </div>

        <div class="my-2 flex gap-2 justify-between">
          <!-- Team filter -->
          <div class="flex-1 relative">
            <label for="teamFilter" class="block text-blue-300">Team</label>
            <input
              onfocus="toggleFilterChecklist('teamCheckList')"
              onblur="closeChecklistOnBlur('teamCheckList')"
              readonly
              type="text"
              placeholder="Team"
              id="teamFilter"
              class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-sm text-white flex-1 w-full"
            />
            <!-- Team Checklist -->
            <div
              id="teamCheckList"
              class="mt-2 bg-gray-800 p-3 rounded shadow border border-gray-700 absolute top-[90%] left-0 w-full z-10 hidden"
            >
              <div class="flex flex-col gap-1" id="teamChecklistContent"></div>
            </div>
          </div>

          <div class="flex-1 relative">
            <label for="statusFilter" class="block text-blue-300">Status</label>
            <input
              onfocus="toggleFilterChecklist('statusCheckList')"
              onblur="closeChecklistOnBlur('statusCheckList')"
              readonly
              type="text"
              placeholder="Status"
              id="statusFilter"
              class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-sm text-white flex-1 w-full"
            />
            <!-- Status Checklist -->
            <div
              id="statusCheckList"
              class="mt-2 bg-gray-800 p-3 rounded shadow border border-gray-700 absolute top-[90%] left-0 w-full z-10 hidden"
            >
              <div
                class="flex flex-col gap-1"
                id="statusChecklistContent"
              ></div>
            </div>
          </div>

          <div class="flex-1">
            <label class="block text-blue-300" for="fromDateFilter"
              >From Date:</label
            >
            <input
              type="date"
              id="fromDateFilter"
              class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-sm text-white w-full"
            />
          </div>

          <div class="flex-1">
            <label class="block text-blue-300" for="toDateFilter"
              >To Date:</label
            >
            <input
              type="date"
              id="toDateFilter"
              class="px-3 py-2 bg-gray-800 border border-gray-700 rounded text-sm text-white w-full"
            />
          </div>
        </div>
      </div>
    </details>

    <!-- Tabs -->
    <div class="border-b border-gray-700 mb-1 flex justify-between">
      <nav class="flex">
        <button
          onclick="loadRequests('action')"
          class="tabBtn text-gray-400 px-3 py-2 hover:text-blue-400 hover:border-b-2 hover:border-blue-400 font-bold"
          data-target="action"
          data-status=""
        >
          <i class="fa-solid fa-arrows-to-dot"></i> Action
        </button>
        <button
          onclick="loadRequests('all')"
          class="tabBtn text-gray-400 px-3 py-2 hover:text-blue-400 hover:border-b-2 hover:border-blue-400 font-bold"
          data-target="all"
          data-status=""
        >
          <i class="fas fa-list"></i> All List
        </button>
      </nav>

      <div class="flex-1">
        <div id="pagination" class="flex justify-end items-center"></div>
      </div>
    </div>

    <!-- Tab Danh sách -->
    <div id="allList" class="tabContent">
      <div
        class="overflow-x-auto rounded border border-gray-800 shadow-lg overflow-y-auto max-h-[65vh]"
      >
        <table
          class="min-w-full text-sm text-gray-300 bg-gray-900 border border-gray-700 border-collapse"
        >
          <thead
            class="bg-gradient-to-r from-blue-500/20 to-purple-600/20 text-slate-200 text-center"
          >
            <tr>
              <th class="px-4 py-1 border border-gray-700">ID Req</th>
              <th class="px-4 py-1 border border-gray-700">Iden. No.</th>
              <th class="px-4 py-1 border border-gray-700">Device Name</th>
              <th class="px-4 py-1 border border-gray-700">Requested By</th>
              <th class="px-4 py-1 border border-gray-700">Department</th>
              <th class="px-4 py-1 border border-gray-700">Team</th>
              <th class="px-4 py-1 border border-gray-700">Requests Date</th>
              <th class="px-4 py-1 border border-gray-700">TAT</th>
              <th class="px-4 py-1 border border-gray-700">Priority</th>
              <th class="px-4 py-1 border border-gray-700">Status</th>
              <th class="px-4 py-1 border border-gray-700">Action ✅</th>
            </tr>
          </thead>
          <tbody
            id="requestsTableBody"
            class="divide-y divide-gray-800"
          ></tbody>
        </table>
      </div>
    </div>
    <!-- View modal -->
    <div
      id="viewModal"
      class="fixed inset-0 w-full z-50 hidden overflow-y-auto"
    >
      <div class="absolute inset-0 bg-bg-black/6"></div>
      <div
        id="viewModalContent"
        class="relative mx-auto my-4 bg-gray-900 rounded shadow-xl w-[85vw] px-6 py-4 overflow-y-auto z-50"
      >
        <!-- Header -->
        <div
          class="flex justify-between items-center border-b border-gray-700 mb-2"
        >
          <h3 class="text-xl font-bold text-white flex items-center gap-2">
            <i class="fa-solid fa-list"></i>
            View Detail
          </h3>
          <button
            onclick="closeModal()"
            class="text-gray-400 hover:text-white p-2 px-3 bg-red-500"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- body -->
        <div id="viewModalBody">
          <!-- Detail Requests -->
          <details
            open
            class="bg-gray-800 rounded p-2 shadow border border-gray-700"
          >
            <summary class="font-semibold text-blue-300 cursor-pointer mb-2">
              <i class="fas fa-info-circle"></i> Request Info
            </summary>
            <div class="grid grid-cols-2 gap-4">
              <table class="w-full text-sm">
                <thead>
                  <tr>
                    <th
                      colspan="2"
                      class="text-center text-lg font-bold text-white border border-gray-700 pb-1 bg-blue-950"
                    >
                      Request Details
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="border border-gray-700">
                    <td
                      class="px-2 py-1 font-semibold border border-gray-700 text-blue-300"
                    >
                      ID Req
                    </td>
                    <td class="px-2">1</td>
                  </tr>
                  <tr class="border border-gray-700">
                    <td
                      class="px-2 py-1 font-semibold border border-gray-700 text-blue-300"
                    >
                      Device
                    </td>
                    <td class="px-2">Tensile</td>
                  </tr>
                  <tr class="border border-gray-700">
                    <td
                      class="px-2 py-1 font-semibold border border-gray-700 text-blue-300"
                    >
                      Requested By
                    </td>
                    <td class="px-2">admin1</td>
                  </tr>
                  <tr class="border border-gray-700">
                    <td
                      class="px-2 py-1 font-semibold border border-gray-700 text-blue-300"
                    >
                      Department
                    </td>
                    <td class="px-2">Hardline</td>
                  </tr>
                  <tr class="border border-gray-700">
                    <td
                      class="px-2 py-1 font-semibold border border-gray-700 text-blue-300"
                    >
                      Team
                    </td>
                    <td class="px-2">CD</td>
                  </tr>
                  <tr class="border border-gray-700">
                    <td
                      class="px-2 py-1 font-semibold border border-gray-700 text-blue-300"
                    >
                      Requests Date
                    </td>
                    <td class="px-2">2025-10-09 08:53</td>
                  </tr>
                  <tr class="border border-gray-700">
                    <td
                      class="px-2 py-1 font-semibold border border-gray-700 text-blue-300"
                    >
                      Status
                    </td>
                    <td class="text-red-400 font-bold px-2">Rejected</td>
                  </tr>
                </tbody>
              </table>

              <table>
                <thead>
                  <tr>
                    <td
                      class="border border-gray-700 text-white font-bold text-lg text-center bg-blue-950"
                    >
                      Device Error Detail
                    </td>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="border border-gray-700 text-white text-center">
                      Device Error
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </details>
          <!-- Thêm chi tiết mở rộng mới -->
          <!-- Timeline -->

          <!-- Detail Cancel -->
          <div id="viewModalDetailCancel" class=""></div>
        </div>

        <!-- Footer -->
        <div
          class="flex justify-end items-center border-t border-gray-700 pt-3"
        >
          <div class="flex gap-2">
            <button
              onclick="closeModal()"
              class="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- End View modal -->
    <!-- Status Update Modal -->
    <div
      id="statusModal"
      class="fixed inset-0 w-full z-50 overflow-y-auto hidden"
    >
      <div class="absolute inset-0 bg-black/60"></div>
      <div class="bg-gray-800 rounded-lg p-6 w-full"></div>
      <form
        id="modalContent"
        class="relative mx-auto my-10 bg-gray-900 rounded shadow-xl p-4 transform transition overflow-y-auto max-w-lg max-h-[90vh]"
      >
        <!-- Header -->
        <div
          class="flex justify-between items-center border-b border-gray-700 mb-2"
        >
          <h3
            class="text-lg font-semibold text-blue-400 flex items-center gap-2"
          >
            <i class="fas fa-pen-to-square"></i> Confirm Status
          </h3>
          <button
            type="button"
            onclick="closeStatusModal()"
            class="text-gray-400 hover:text-white px-2 py-1 bg-red-400"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <!-- body -->
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-blue-300">
              Status
            </label>
            <select
              id="newStatus"
              onchange="requireRemark(this.value)"
              class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
            >
              <option value="">-- Choose Status --</option>
              <option value="Done">Done</option>
              <option value="PendingEvaluationAgain">Re-evaluate</option>
            </select>
          </div>

          <div>
            <label
              id="statusNoteLabel"
              class="block text-s m font-medium text-blue-300"
            >
              Remark
            </label>
            <textarea
              id="statusNote"
              class="w-full p-2 bg-gray-700 border border-gray-600 rounded text-white"
              rows="5"
              placeholder="Enter remark..."
            ></textarea>
          </div>
        </div>

        <!-- Footer -->
        <div class="flex justify-end space-x-2 pt-2 border-t border-gray-700">
          <button
            type="button"
            onclick="closeStatusModal()"
            class="px-4 py-2 bg-gray-600 hover:bg-gray-500 rounded text-white"
          >
            Close
          </button>
          <button
            type="submit"
            class="px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded text-white"
          >
            Save
          </button>
        </div>

        <!-- Hidden fields -->
        <input type="hidden" id="currentRequestId" />
        <input type="hidden" id="deviceId" />
      </form>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const firstTab = document
          .querySelector(".tabBtn[data-target='action']")
          .click(typeTab);
      });
    </script>

    <script>
      const userLabId = "{{ current_user.idlab }}";
      const userTeamId = "{{ current_user.idteam }}";
      const userRoleId = "{{ current_user.role_id }}";
      const userId = "{{ current_user.id }}";
      const userName = "{{ current_user.username }}";
    </script>

    <!-- JS -->
    <script src="{{ url_for('static', filename='js/my_request.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/function_date-time.js') }}"></script>
  </body>
</html>
